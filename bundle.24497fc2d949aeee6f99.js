(()=>{"use strict";const t=60,e=60,i=400,n=10,o=40,r=500,s=5,h=50,u=200,p=-40,d=40,c=5;var a=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.angle=function(){return 180*Math.atan2(this.y,this.x)/Math.PI},t}();const l=a;var f=function(t,e){return new a(t.x+e.x,t.y+e.y)},y=function(t,e){return new a(t.x*e,t.y*e)},g=function(t,e){var i=Math.PI/180*e;return new a(t*Math.cos(i),t*Math.sin(i))},m=function(e,i,n){var o=y(i,1/t),r=f(e,o);return n&&v(r),r},v=function(t){t.x=t.x%window.innerWidth,t.y=t.y%window.innerHeight,t.x<0&&(t.x=window.innerWidth),t.y<0&&(t.y=window.innerHeight)},w=function(t,e){return(t+e/60/60*360)%360};const b=function(){function t(e,i){this.position=e,this.velocity=g(r,i),this.hit=!1,this.bulletId=t.nextBulletId,t.nextBulletId+=1}return t.prototype.getIdString=function(){return"bullet"+this.bulletId},t.prototype.tick=function(){this.position=m(this.position,this.velocity,!1)},t.prototype.alive=function(){return!(this.hit||this.position.x>window.innerWidth||this.position.y>window.innerHeight||this.position.x<0||this.position.y<0)},t.prototype.collided=function(t){t.isAsteroid()&&(this.hit=!0)},t.prototype.remove=function(t){var e=document.getElementById(this.getIdString());e&&t.removeChild(e)},t.prototype.createElement=function(t){var e=document.createElementNS(t.namespaceURI,"circle");t.appendChild(e),e.classList.add("bullet"),e.setAttribute("id",this.getIdString()),e.setAttribute("r",String(s))},t.prototype.render=function(t){document.getElementById(this.getIdString())||this.createElement(t);var e=document.getElementById(this.getIdString()),i="translate("+this.position.x+", "+this.position.y+")";e.setAttribute("transform",i)},t.prototype.getRadius=function(){return s},t.prototype.getPosition=function(){return this.position},t.prototype.isAsteroid=function(){return!1},t.prototype.isBullet=function(){return!0},t.prototype.onDeadReturn=function(){return[]},t.nextBulletId=0,t}(),I=function(){function t(){this.position=new l(window.innerWidth/2,window.innerHeight/2),this.velocity=new l(0,0),this.rotation=90,this.rpm=0,this.dead=!1}return t.prototype.tick=function(){this.position=m(this.position,this.velocity,!0),this.rotation=w(this.rotation,this.rpm)},t.prototype.alive=function(){return!this.dead},t.prototype.thrust=function(){var t,n,o=g(e,this.rotation),r=new l(o.x,-o.y);this.velocity=f(this.velocity,r),this.velocity.magnitude()<=i||(this.velocity=(t=this.velocity,n=i,y(function(t){var e=t.magnitude();return y(t,1/e)}(t),n)))},t.prototype.turnLeft=function(){this.rpm+=n,this.handleMaxRpm()},t.prototype.turnRight=function(){this.rpm-=n,this.handleMaxRpm()},t.prototype.handleMaxRpm=function(){this.rpm>o?this.rpm=o:this.rpm<-o&&(this.rpm=-o)},t.prototype.shoot=function(){return new b(this.position,-this.rotation)},t.prototype.createElement=function(t){var e=document.createElementNS(t.namespaceURI,"polygon");t.appendChild(e),e.setAttribute("id","ship"),e.setAttribute("points","0,0 0,30 50,15")},t.prototype.render=function(t){document.getElementById("ship")||this.createElement(t);var e=document.getElementById("ship"),i="translate("+(this.position.x-25)+", "+(this.position.y-15)+") rotate("+-this.rotation+" 25 15) ";e.setAttribute("transform",i)},t.prototype.getPosition=function(){return this.position},t.prototype.getRadius=function(){return 15},t.prototype.isAsteroid=function(){return!1},t.prototype.isBullet=function(){return!1},t.prototype.collided=function(t){t.isAsteroid()&&(this.dead=!0)},t.prototype.remove=function(t){var e=document.getElementById("ship");e&&t.removeChild(e)},t.prototype.onDeadReturn=function(){return[]},t}();var x=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t};const E="20,20 35,5 55,20 85,20 90,60 60,70 35,90 10,60 20,40",j="10,10 16,3 26,10 42,10 45,30 30,35 17,45 5,30 10,20",A=function(){function t(e,i){void 0===i&&(i=null),this.small=e,this.velocity=g(x(h,u),x(0,360)),this.position=null===i?new l(window.innerWidth,window.innerHeight):i,this.rotation=0,this.rpm=x(p,d),this.asteroidId=t.nextAsteroidId,this.dead=!1,t.nextAsteroidId+=1}return t.prototype.getIdString=function(){return"asteroid"+this.asteroidId},t.prototype.getPoints=function(){return this.small?j:E},t.prototype.tick=function(){this.position=m(this.position,this.velocity,!0),this.rotation=w(this.rotation,this.rpm)},t.prototype.createElement=function(t){var e=document.createElementNS(t.namespaceURI,"polygon");t.appendChild(e),e.setAttribute("id",this.getIdString()),e.setAttribute("points",this.getPoints()),e.classList.add("asteroid")},t.prototype.getWidthHeight=function(){return this.small?50:100},t.prototype.render=function(t){document.getElementById(this.getIdString())||this.createElement(t);var e=document.getElementById(this.getIdString()),i="translate("+(this.position.x-this.getWidthHeight()/2)+", "+(this.position.y-this.getWidthHeight()/2)+") rotate("+-this.rotation+" "+this.getWidthHeight()/2+" "+this.getWidthHeight()/2+") ";e.setAttribute("transform",i)},t.prototype.remove=function(t){var e=document.getElementById(this.getIdString());e&&t.removeChild(e)},t.prototype.break=function(){if(this.small)return[];var e=[];return e.push(new t(!0,this.position)),e.push(new t(!0,this.position)),e.push(new t(!0,this.position)),e},t.prototype.getPosition=function(){return this.position},t.prototype.getRadius=function(){return this.getWidthHeight()/2},t.prototype.isSmall=function(){return this.small},t.prototype.isAsteroid=function(){return!0},t.prototype.isBullet=function(){return!1},t.prototype.collided=function(t){t.isBullet()&&(this.dead=!0)},t.prototype.alive=function(){return!this.dead},t.addAsteroid=function(e,i){return e%240==0&&i<c?[new t(!1)]:[]},t.prototype.onDeadReturn=function(){return this.break()},t.nextAsteroidId=0,t}();const O=function(t,e){(function(t,e){var i,n;return(i=t.getPosition(),n=e.getPosition(),new a(i.x-n.x,i.y-n.y)).magnitude()-t.getRadius()-e.getRadius()<0})(t,e)&&(t.collided(e),e.collided(t))},k=function(){function t(){this.resetState()}return t.prototype.resetState=function(){this.ship=new I,this.deadObjects=this.gameObjects||[],this.gameObjects=[this.ship],this.paused=!0,this.tickCount=0,this.over=!1},t.prototype.render=function(t){this.gameObjects.forEach((function(e){return e.render(t)})),this.deadObjects.forEach((function(e){return e.remove(t)})),this.deadObjects=[];var e=document.getElementById("message");e.style.visibility=this.paused||this.over?"visible":"hidden",e.textContent=this.paused?"Press <esc> to continue":"Press <r> to restart"},t.prototype.getDeadObjects=function(){return this.gameObjects.filter((function(t){return!t.alive()}))},t.prototype.removeDeadObjects=function(){this.deadObjects=this.gameObjects.filter((function(t){return!t.alive()})),this.gameObjects=this.gameObjects.filter((function(t){return t.alive()}))},t.prototype.tick=function(){if(!this.paused&&!this.over){this.removeDeadObjects(),this.gameObjects=this.deadObjects.reduce((function(t,e){return t.concat(e.onDeadReturn())}),this.gameObjects),this.gameObjects.forEach((function(t){return t.tick()}));var t=this.gameObjects.filter((function(t){return t.isAsteroid()})).filter((function(t){return t.isSmall()})).length;this.gameObjects=this.gameObjects.concat(A.addAsteroid(this.tickCount,t)),this.handleCollisions(),this.ship.alive()||(this.over=!0),this.tickCount+=1}},t.prototype.handleCollisions=function(){for(var t=this.gameObjects,e=0;e<t.length;e++)for(var i=e;i<t.length;i++)O(t[e],t[i])},t.prototype.togglePaused=function(){this.paused=!this.paused},t.prototype.inputHandler=function(t){if(!this.over&&("Escape"===t.key&&(this.paused=!this.paused),!this.paused))if("ArrowUp"===t.key||"w"===t.key)this.ship.thrust();else if("ArrowLeft"===t.key||"a"===t.key)this.ship.turnLeft();else if("ArrowRight"===t.key||"d"===t.key)this.ship.turnRight();else if(" "===t.key){var e=this.ship.shoot();this.gameObjects.push(e)}},t}();var S=document.getElementById("svg"),B=new k;B.render(S),setInterval((function(){B.tick(),B.render(S)}),1e3/t),window.addEventListener("keydown",(function(t){"r"===t.key&&(B.resetState(),B.render(S))})),window.addEventListener("keydown",(function(t){B.inputHandler(t)}))})();